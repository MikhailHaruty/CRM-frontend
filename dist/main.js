(()=>{const e=document.querySelector(".table__body"),t=document.querySelector(".clients__button"),n=document.querySelector(".header__input");function a(t){let n=[];if("sort-id"===t.id){for(const t of e.children)n.push(t.children[0].textContent);l(t,n)}if("sort-name"===t.id){for(const t of e.children)n.push(t.children[1].textContent);n=n.map((e=>e.split(" ")[0])),l(t,n)}if("sort-date"===t.id){for(const t of e.children)n.push(t.children[2].textContent);n=n.map((e=>e.split("."))),n=n.map((e=>`${e[1]}.${e[0]}.${e[2]}`)),n=n.map((e=>new Date(e).getTime())),l(t,n)}if("sort-changes"===t.id){for(const t of e.children)n.push(t.children[3].textContent);l(t,n)}}async function l(t,n){const a=await fetch("http://localhost:3000/api/clients"),l=await a.json(),s=document.querySelector("#sort-id"),o=document.querySelector("#sort-name"),d=document.querySelector("#sort-date"),c=document.querySelector("#sort-changes");for(const t of Array.from(e.children))t.remove();const i=t.children[0].classList.contains("ascending")?n.sort():n.sort().reverse(),m=[],u=JSON.parse(JSON.stringify(l));let p=0;for("sort-id"!==t.id&&s.children[0].classList.add("ascending"),"sort-name"!==t.id&&o.children[0].classList.add("descending"),"sort-date"!==t.id&&d.children[0].classList.add("descending"),"sort-changes"!==t.id&&c.children[0].classList.add("descending");m.length<u.length;)"sort-id"===t.id&&(i[0]==l[p].id?(m.push(l[p]),i.splice(0,1),l.splice(p,1),p=0):p<=l.length-1&&p++),"sort-name"===t.id&&(i[0]===l[p].surname?(m.push(l[p]),i.splice(0,1),l.splice(p,1),p=0):p<=l.length-1&&p++),"sort-date"===t.id&&(l.sort((function(e,n){let a=new Date(e.createdAt),l=new Date(n.createdAt);return t.children[0].classList.contains("ascending")?l.getTime()-a.getTime():t.children[0].classList.contains("descending")?a.getTime()-l.getTime():void 0})),m.push(l[[p]]),p++),"sort-changes"===t.id&&(l.sort((function(e,n){let a=new Date(e.updatedAt),l=new Date(n.updatedAt);return t.children[0].classList.contains("ascending")?l.getTime()-a.getTime():t.children[0].classList.contains("descending")?a.getTime()-l.getTime():void 0})),m.push(l[[p]]),p++);for(const e of m)r(e)}function s(e){!function(e){e.classList.contains("table__change")&&(e.children[0].remove(),e.innerHTML='\n      <svg class="table__icon" width="12" height="12" viewBox="0 0 13 13" fill="none" xmlns="http://www.w3.org/2000/svg">\n        <path d="M1.00008 6.04008C1.00008 8.82356 3.2566 11.0801 6.04008 11.0801C8.82356 11.0801 11.0801 8.82356 11.0801 6.04008C11.0801 3.2566 8.82356 1.00008 6.04008 1.00008C5.38922 1.00008 4.7672 1.12342 4.196 1.34812" stroke="#9873FF" stroke-width="2" stroke-miterlimit="10" stroke-linecap="round"/>\n      </svg>\n      Change',e.classList.add("table__change--active")),e.classList.contains("table__delete")&&(e.children[0].remove(),e.innerHTML='\n      <svg class="table__icon" width="12" height="12" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n        <path d="M3.00008 8.04008C3.00008 10.8236 5.2566 13.0801 8.04008 13.0801C10.8236 13.0801 13.0801 10.8236 13.0801 8.04008C13.0801 5.2566 10.8236 3.00008 8.04008 3.00008C7.38922 3.00008 6.7672 3.12342 6.196 3.34812" stroke="#F06A4D" stroke-width="2" stroke-miterlimit="10" stroke-linecap="round"/>\n      </svg>\n      Delete',e.classList.add("table__delete--active"))}(e);const t=document.createElement("div"),n=document.createElement("div"),a=document.createElement("h3"),l=document.createElement("span"),s=document.createElement("div"),c=document.createElement("div"),i=document.createElement("div"),r=document.createElement("div"),m=document.createElement("p"),u=document.createElement("label"),p=document.createElement("label"),L=document.createElement("label"),h=document.createElement("span"),_=document.createElement("span"),v=document.createElement("span"),g=document.createElement("div"),f=document.createElement("input"),C=document.createElement("input"),b=document.createElement("input"),x=document.createElement("button"),E=document.createElement("button"),w=document.createElement("button"),y=document.createElement("button");return document.body.classList.add("stop-scroll"),t.classList.add("modal"),n.classList.add("modal__window"),a.classList.add("modal__title"),l.classList.add("modal__id"),s.classList.add("modal__content"),c.classList.add("modal__content"),i.classList.add("modal__content"),m.classList.add("modal__text"),u.classList.add("modal__label"),p.classList.add("modal__label"),L.classList.add("modal__label"),h.classList.add("modal__descr"),_.classList.add("modal__descr"),v.classList.add("modal__descr"),r.classList.add("modal__contacts"),g.classList.add("modal__inputs"),f.classList.add("modal__input"),f.id="surname-input",C.classList.add("modal__input"),C.id="name-input",b.classList.add("modal__input"),b.id="lastname-input",x.classList.add("modal__button","button-reset"),E.classList.add("modal__confirm","button-reset"),w.classList.add("modal__cancel","button-reset"),y.classList.add("modal__close","button-reset"),y.innerHTML='\n    <svg class="modal__close-icon" width="20" height="20" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg">\n      <path fill-rule="evenodd" clip-rule="evenodd" d="M16.2332 1.73333L15.2665 0.766664L8.49985 7.53336L1.73318 0.766696L0.766515 1.73336L7.53318 8.50003L0.766542 15.2667L1.73321 16.2333L8.49985 9.46669L15.2665 16.2334L16.2332 15.2667L9.46651 8.50003L16.2332 1.73333Z"/>\n    </svg>',h.textContent="Surname*",_.textContent="Name*",v.textContent="Last Name",x.textContent="Add Contact",E.textContent="Save",f.placeholder="Surname",C.placeholder="Name",b.placeholder="Last Name",setTimeout((()=>t.classList.add("modal--active")),50),x.addEventListener("click",(()=>d(x))),t.addEventListener("click",(n=>{n.target==t&&o(t,e)})),e.classList.contains("table__delete")?[t,n,c,a,m,E,w,y]:(u.append(h,f),p.append(_,C),L.append(v,b),g.append(u,p,L),s.append(a,g),e.classList.contains("table__change")&&s.append(l),c.append(x),i.append(E,w),r.append(c),n.append(s,r,i,y),t.append(n),document.body.append(t),document.querySelectorAll(".modal__input").forEach((e=>e.addEventListener("input",(()=>function(e){e.parentNode.children[0].classList.add("modal__descr--active"),e.classList.remove("modal__input--error"),e.value||e.parentNode.children[0].classList.remove("modal__descr--active")}(e))))),[t,n,a,l,f,C,b,x,E,w,y])}function o(e,t){e.remove(),function(e){e.children[0].remove(),e.classList.contains("table__change")&&(e.innerHTML='\n      <svg class="table__icon" width="12" height="12" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n        <path d="M2 11.5V14H4.5L11.8733 6.62662L9.37333 4.12662L2 11.5ZM13.8067 4.69329C14.0667 4.43329 14.0667 4.01329 13.8067 3.75329L12.2467 2.19329C11.9867 1.93329 11.5667 1.93329 11.3067 2.19329L10.0867 3.41329L12.5867 5.91329L13.8067 4.69329Z" fill="#9873ff"/>\n      </svg>\n      Change',e.classList.remove("table__change--active")),e.classList.contains("table__delete")&&(e.innerHTML='\n      <svg class="table__icon" width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">\n        <path d="M6 0C2.682 0 0 2.682 0 6C0 9.318 2.682 12 6 12C9.318 12 12 9.318 12 6C12 2.682 9.318 0 6 0ZM6 10.8C3.354 10.8 1.2 8.646 1.2 6C1.2 3.354 3.354 1.2 6 1.2C8.646 1.2 10.8 3.354 10.8 6C10.8 8.646 8.646 10.8 6 10.8ZM8.154 3L6 5.154L3.846 3L3 3.846L5.154 6L3 8.154L3.846 9L6 6.846L8.154 9L9 8.154L6.846 6L9 3.846L8.154 3Z" fill="#F06A4D"/>\n      </svg>\n      Delete',e.classList.remove("table__delete--active"))}(t),document.body.classList.remove("stop-scroll")}function d(e,t="Phone",n=""){const a=document.createElement("div"),l=document.createElement("div");let s=document.createElement("button");const o=document.createElement("div"),d=document.createElement("button"),c=document.createElement("button"),i=document.createElement("button"),r=document.createElement("button"),m=document.createElement("input");if(a.classList.add("modal__contact"),l.classList.add("modal__select"),s.classList.add("modal__select-inner","button-reset"),s.textContent="Phone",s.value=`${t}`,o.classList.add("modal__select-list"),d.classList.add("modal__select-item","button-reset"),d.textContent="Social",d.value="extraPhone",c.classList.add("modal__select-item","button-reset"),c.textContent="Email",c.value="Email",i.classList.add("modal__select-item","button-reset"),i.textContent="VK",i.value="VK",r.classList.add("modal__select-item","button-reset"),r.textContent="Facebook",r.value="Facebook",m.classList.add("modal__data"),m.placeholder="Input contact's info",o.append(d),o.append(c),o.append(i),o.append(r),l.append(s),l.append(o),a.append(l),a.append(m),e.before(a),""==n&e.parentNode.children.length>2||n&&""!=n){const e=document.createElement("button");e.classList.add("modal__remove","button-reset"),a.append(e),e.addEventListener("click",(()=>a.remove()))}"Phone"==t&&(s.textContent="Phone",m.type="tel"),"extraPhone"==t&&(s.textContent="Social",m.type="text"),"Email"==t&&(s.textContent="Email",m.type="email"),"VK"==t&&(s.textContent="VK",m.type="text"),"Facebook"==t&&(s.textContent="Facebook",m.type="text"),m.value=`${n}`;for(const e of o.children)s.textContent==e.textContent&&s.value==e.value&&(e.textContent="Phone",e.value="Phone");s.addEventListener("click",(()=>{l.classList.toggle("modal__select--active"),o.classList.toggle("modal__select-list--active")}));for(let e of o.children)e.addEventListener("click",(()=>{e.value=[s.value,s.value=e.value][0],e.textContent=[s.textContent,s.textContent=e.textContent][0],l.classList.remove("modal__select--active"),o.classList.remove("modal__select-list--active"),m.value="","Phone"==s.value&&(m.type="tel"),"Email"==s.value&&(m.type="email"),"VK"==s.value&&(m.type="text"),"Facebook"==s.value&&(m.type="text"),"extraPhone"==s.value&&(m.type="text")}))}function c(){const e=document.querySelectorAll(".modal__contact"),t=[];return e.forEach((e=>{e.firstChild.firstChild.value&&e.children[1].value&&t.push({type:e.firstChild.firstChild.value,value:e.children[1].value})})),t}function i(e,t){if(Array.from(e.children).length)for(const t of Array.from(e.children))t.remove();for(const n of t.contacts){const t=document.createElement("a");t.classList.add("table__info"),"Phone"==n.type&&t.classList.add("table__info--phone"),"extraPhone"==n.type&&t.classList.add("table__info--extraphone"),"Email"==n.type&&t.classList.add("table__info--email"),"VK"==n.type&&t.classList.add("table__info--vk"),"Facebook"==n.type&&t.classList.add("table__info--facebook"),t.setAttribute("data-value",n.value),e.append(t)}if(t.contacts.length>5){const n=[];for(const t of e.children)n.push(t);for(const e of n.slice(4))e.classList.add("table__info--hidden");const a=document.createElement("button");a.classList.add("table__show-more","button-reset"),a.textContent=`+${t.contacts.slice(4).length}`,e.append(a),a.addEventListener("click",(()=>{a.style.display="none";for(const e of n.slice(4))e.classList.remove("table__info--hidden")}))}}async function r(t=null){const n=document.querySelector("#name-input"),a=document.querySelector("#surname-input"),l=document.querySelector("#lastname-input");if(!t){if(!a.value)return void a.classList.add("modal__input--error");if(!n.value)return void n.classList.add("modal__input--error")}const s=document.createElement("tr"),o=document.createElement("td"),d=document.createElement("td"),r=document.createElement("td"),p=document.createElement("span"),L=document.createElement("span"),h=document.createElement("td"),_=document.createElement("span"),v=document.createElement("span"),g=document.createElement("td"),f=document.createElement("td"),C=document.createElement("button"),b=document.createElement("button");C.innerHTML='\n    <svg class="table__icon" width="12" height="12" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n      <path d="M2 11.5V14H4.5L11.8733 6.62662L9.37333 4.12662L2 11.5ZM13.8067 4.69329C14.0667 4.43329 14.0667 4.01329 13.8067 3.75329L12.2467 2.19329C11.9867 1.93329 11.5667 1.93329 11.3067 2.19329L10.0867 3.41329L12.5867 5.91329L13.8067 4.69329Z" fill="#9873ff"/>\n    </svg>\n    Change',b.innerHTML='\n    <svg class="table__icon" width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">\n      <path d="M6 0C2.682 0 0 2.682 0 6C0 9.318 2.682 12 6 12C9.318 12 12 9.318 12 6C12 2.682 9.318 0 6 0ZM6 10.8C3.354 10.8 1.2 8.646 1.2 6C1.2 3.354 3.354 1.2 6 1.2C8.646 1.2 10.8 3.354 10.8 6C10.8 8.646 8.646 10.8 6 10.8ZM8.154 3L6 5.154L3.846 3L3 3.846L5.154 6L3 8.154L3.846 9L6 6.846L8.154 9L9 8.154L6.846 6L9 3.846L8.154 3Z" fill="#F06A4D"/>\n    </svg>\n    Delete',s.classList.add("table__item"),o.classList.add("table__id"),d.classList.add("table__fullname"),r.classList.add("table__date"),p.classList.add("table__date-date"),L.classList.add("table__date-time"),_.classList.add("table__date-date"),v.classList.add("table__date-time"),h.classList.add("table__date"),g.classList.add("table__contacts"),f.classList.add("table__actions"),C.classList.add("table__change","button-reset"),b.classList.add("table__delete","button-reset");const x=t||await async function(e,t,n,a){if(!e){const e=await fetch("http://localhost:3000/api/clients",{method:"POST",body:JSON.stringify({name:(t.value[0].toUpperCase()+t.value.slice(1)).trim(),surname:(n.value[0].toUpperCase()+n.value.slice(1)).trim(),lastName:a.value?(a.value[0].toUpperCase()+a.value.slice(1)).trim():"",contacts:c()}),headers:{"Content-Type":"application/json"}});return await e.json()}}(t,n,a,l),E=new Date(x.createdAt),w=new Date(x.updatedAt);E.getDate()<10&&E.getMonth()<9?p.textContent=`0${E.getDate()}.0${E.getMonth()+1}.${E.getFullYear()} `:E.getDate()<10?p.textContent=`0${E.getDate()}.${E.getMonth()+1}.${E.getFullYear()} `:E.getMonth()<9?p.textContent=`${E.getDate()}.0${E.getMonth()+1}.${E.getFullYear()} `:p.textContent=`${E.getDate()}.${E.getMonth()+1}.${E.getFullYear()} `,w.getDate()<10&&w.getMonth()<9?_.textContent=`0${w.getDate()}.0${w.getMonth()+1}.${w.getFullYear()} `:w.getDate()<10?_.textContent=`0${w.getDate()}.${w.getMonth()+1}.${w.getFullYear()} `:w.getMonth()<9?_.textContent=`${w.getDate()}.0${w.getMonth()+1}.${w.getFullYear()} `:_.textContent=`${w.getDate()}.${w.getMonth()+1}.${w.getFullYear()} `,E.getHours()<10&&E.getMinutes()<10?L.textContent=`0${E.getHours()}:0${E.getMinutes()}`:E.getHours()<10?L.textContent=`0${E.getHours()}:${E.getMinutes()}`:E.getMinutes()<10?L.textContent=`${E.getHours()}:0${E.getMinutes()}`:L.textContent=`${E.getHours()}:${E.getMinutes()}`,w.getHours()<9&&w.getMinutes()<10?v.textContent=`0${w.getHours()}:0${w.getMinutes()}`:w.getHours()<10?v.textContent=`0${w.getHours()}:${w.getMinutes()}`:w.getMinutes()<10?v.textContent=`${w.getHours()}:0${w.getMinutes()}`:v.textContent=`${w.getHours()}:${w.getMinutes()}`,o.textContent=x.id,d.textContent=`${x.surname} ${x.name} ${x.lastName}`,i(g,x);const y=o.textContent;r.append(p),r.append(L),h.append(_),h.append(v),f.append(C),f.append(b),s.append(o),s.append(d),s.append(r),s.append(h),s.append(g),s.append(f),e.append(s);const $=document.querySelector(".modal");$&&$.remove(),b.addEventListener("click",(()=>u(b,y))),C.addEventListener("click",(()=>m(C,y)))}async function m(e,t){const n=await(await fetch(`http://localhost:3000/api/clients/${t}`)).json();[modal,modalWindow,modalTitle,modalId,inputSurname,inputName,inputLastname,addBtn,confirmBtn,cancelBtn,closeBtn]=s(e),modalTitle.textContent="Change data",modalId.textContent=`ID: ${t}`,cancelBtn.textContent="Delete Client",inputSurname.value=n.surname,inputName.value=n.name,inputLastname.value=n.lastName;for(const e of n.contacts)d(addBtn,e.type,e.value);closeBtn.addEventListener("click",(()=>o(modal,e))),cancelBtn.addEventListener("click",(()=>u(modal,e))),confirmBtn.addEventListener("click",(async()=>{if(!inputSurname.value)return void inputSurname.classList.add("modal__input--error");if(!inputName.value)return void inputName.classList.add("modal__input--error");const n=await(await fetch(`http://localhost:3000/api/clients/${t}`,{method:"PATCH",body:JSON.stringify({name:inputName.value,surname:inputSurname.value,lastName:inputLastname.value,contacts:c()})})).json(),a=new Date(n.updatedAt);e.parentNode.parentNode.children[1].textContent=`${n.surname} ${n.name} ${n.lastName}`,e.parentNode.parentNode.children[3].firstChild.textContent=`${a.getDay()}.${a.getMonth()}.${a.getFullYear()}`,e.parentNode.parentNode.children[3].lastChild.textContent=`${a.getHours()}:${a.getMinutes()}`,i(e.parentNode.parentNode.children[4],n),o(modal,e)}))}function u(e,t){[modal,modalWindow,modalWrapper,modalTitle,modalText,confirmBtn,cancelBtn,closeBtn]=s(e),modalTitle.textContent="Delete Client",modalText.textContent="Are you sure?",confirmBtn.textContent="Delete",cancelBtn.textContent="Cancel",modalTitle.classList.add("center"),modalText.classList.add("center"),modalWrapper.append(modalTitle),modalWrapper.append(modalText),modalWrapper.append(confirmBtn),modalWrapper.append(cancelBtn),modalWrapper.append(closeBtn),modalWindow.append(modalWrapper),modal.append(modalWindow),document.body.append(modal),closeBtn.addEventListener("click",(()=>o(modal,e))),cancelBtn.addEventListener("click",(()=>o(modal,e))),confirmBtn.addEventListener("click",(async()=>{const n=e.parentNode.parentNode;await fetch(`http://localhost:3000/api/clients/${t}`,{method:"DELETE"}),n.remove();for(const t of document.querySelectorAll(".modal"))o(t,e)}))}!async function(){const e=await fetch("http://localhost:3000/api/clients"),t=await e.json();for(const e of t)r(e)}(),function(){const e=document.querySelectorAll(".table__button");e.forEach((t=>{t.addEventListener("click",(()=>{e.forEach((e=>e.classList.remove("table__button--active"))),t.classList.add("table__button--active"),t.children[0].classList.contains("ascending")?(t.children[0].classList.remove("ascending"),t.children[0].classList.add("descending"),a(t)):t.children[0].classList.contains("descending")&&(t.children[0].classList.remove("descending"),t.children[0].classList.add("ascending"),a(t))}))}))}(),t.addEventListener("click",(()=>{return e=t,[modal,modalWindow,modalTitle,modalId,inputSurname,inputName,inputLastname,addBtn,confirmBtn,cancelBtn,closeBtn]=s(e),modalTitle.textContent="New Client",cancelBtn.textContent="Cancel",closeBtn.addEventListener("click",(()=>modal.remove())),cancelBtn.addEventListener("click",(()=>modal.remove())),void confirmBtn.addEventListener("click",(()=>{r()}));var e})),n.addEventListener("input",(()=>setTimeout((()=>{const t=Array.from(e.children).filter((e=>e.children[1].textContent.toLowerCase().includes(n.value.toLowerCase())));for(const n of Array.from(e.children))t.includes(n)?n.style.display="flex":n.style.display="none"}),300)))})();